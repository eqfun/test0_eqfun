<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íšŒì›ê°€ì…</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 400px;
      margin: 50px auto;
      padding: 20px;
      background: #f0f4f8;
    }
    .register-container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #2980b9;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 0;
    }
    button:hover {
      background: #3498db;
    }
    #register-message {
      margin-top: 10px;
      text-align: center;
      color: #e74c3c;
      white-space: pre-line;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      min-height: 100px;
      font-size: 1.1em;
      line-height: 1.5;
      display: block;
      visibility: visible;
    }
    .success-message {
      color: #2ecc71 !important;
      border: 1px solid #2ecc71;
      background-color: #f0fff4;
      padding: 20px;
    }
    .error-message {
      color: #e74c3c !important;
      border: 1px solid #e74c3c;
    }
    .back-to-login {
      text-align: center;
      margin-top: 20px;
    }
    .back-to-login a {
      color: #2980b9;
      text-decoration: none;
    }
    .back-to-login a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="register-container">
    <h2>ğŸ“ íšŒì›ê°€ì…</h2>
    <form id="register-form">
      <input type="email" id="email" placeholder="ì´ë©”ì¼ ì…ë ¥" required>
      <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
      <input type="password" id="confirm-password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
      <input type="text" id="name" placeholder="ì´ë¦„ ì…ë ¥" required>
      <select id="user-type" required>
        <option value="">ì‚¬ìš©ì ìœ í˜• ì„ íƒ</option>
        <option value="elementary">ì´ˆë“±í•™ìƒ</option>
        <option value="middle">ì¤‘í•™ìƒ</option>
        <option value="high">ê³ ë“±í•™ìƒ</option>
        <option value="teacher">êµì‚¬</option>
        <option value="adult">ì„±ì¸</option>
      </select>
      <button type="button" onclick="register()">íšŒì›ê°€ì…</button>
    </form>
    <div id="register-message"></div>
    <div class="back-to-login">
      <a href="login.html">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <!-- Firebase SDK ì¶”ê°€ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì´ˆê¸°í™” ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyBE0r282qiZAoL6MCYbpLt-Zmxp7JDYMVk",
      authDomain: "test-equilibrifun.firebaseapp.com",
      projectId: "test-equilibrifun",
      storageBucket: "test-equilibrifun.firebasestorage.app",
      messagingSenderId: "804507284339",
      appId: "1:804507284339:web:d03de182b9e8fadccb0b06",
      measurementId: "G-HXPF6NZE8D"
    };

    // Firebase ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <script>
    window.register = async function() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const name = document.getElementById('name').value;
      const userType = document.getElementById('user-type').value;
      const messageElement = document.getElementById('register-message');

      // ì…ë ¥ê°’ ê²€ì¦
      if (!email || !password || !name || !userType) {
        messageElement.style.color = '#e74c3c';
        messageElement.textContent = "âŒ ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      try {
        // ì‚¬ìš©ì ìƒì„±
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Firestoreì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
        await db.collection('users').doc(user.uid).set({
          name: name,
          email: email,
          userType: userType,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          emailVerified: false,
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ì „ì†¡
        await user.sendEmailVerification();
        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        messageElement.style.color = '#2ecc71';
        messageElement.innerHTML = `
          âœ… íšŒì›ê°€ì… ì„±ê³µ!<br>
          ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.<br>
          <small style="color: #7f8c8d;">
            - ì´ë©”ì¼ ì¸ì¦ í›„ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
            - ìŠ¤íŒ¸ ë©”ì¼í•¨ë„ í™•ì¸í•´ì£¼ì„¸ìš”.<br>
            - ì¸ì¦ ë©”ì¼ì´ ë„ì°©í•˜ì§€ ì•Šìœ¼ë©´ ì¬ì „ì†¡ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
          </small>
        `;

        // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 5000);
      } catch (error) {
        console.error('íšŒì›ê°€ì… ì—ëŸ¬:', error);
        messageElement.style.color = '#e74c3c';
        messageElement.textContent = "âŒ " + error.message;
      }
    };
  </script>
</body>
</html>
