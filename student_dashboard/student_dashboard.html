<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•™ìŠµ í˜„í™© í™•ì¸</title>
  <script src="https://www.gstatic.com/firebasejs/8.2.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.4/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.4/firebase-firestore.js"></script>
  <!-- ê³µí†µ CSS ì¶”ê°€ -->
  <link rel="stylesheet" href="../styles/common.css">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-info button {
      padding: 8px 16px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .user-info button:hover {
      background: #d32f2f;
    }

    .activity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .activity-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .activity-card.completed {
      border-left: 4px solid #4CAF50;
    }

    .activity-card.in_progress {
      border-left: 4px solid #FFC107;
    }

    .activity-card.not_started {
      border-left: 4px solid #9E9E9E;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: #f0f0f0;
      border-radius: 5px;
      margin: 10px 0;
    }

    .progress {
      height: 100%;
      background: #4CAF50;
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .start-button {
      display: inline-block;
      padding: 8px 16px;
      background: #2196F3;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }

    .start-button:hover {
      background: #1976D2;
    }
  </style>
</head>
<body>
  <!-- ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ëŠ” ë²„íŠ¼ -->
  <button class="home-button" onclick="window.location.href='../index.html'">
    ğŸ  ì²˜ìŒìœ¼ë¡œ
  </button>

  <div class="dashboard-container">
    <div class="header">
      <h1>í•™ìƒ ëŒ€ì‹œë³´ë“œ</h1>
      <div class="user-info">
        <span id="userName"></span>
        <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div class="activity-grid">
      <!-- í™œë™ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>
  </div>

  <script>
    // Firebase ì´ˆê¸°í™”
    const firebaseConfig = {
      apiKey: "AIzaSyBE0r282qiZAoL6MCYbpLt-Zmxp7JDYMVk",
      authDomain: "test-equilibrifun.firebaseapp.com",
      projectId: "test-equilibrifun",
      storageBucket: "test-equilibrifun.appspot.com",
      messagingSenderId: "804507284339",
      appId: "1:804507284339:web:d03de182b9e8fadccb0b06"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();

    // ì‚¬ìš©ì ì •ë³´ ë° í™œë™ ìƒíƒœ ë¡œë“œ
    firebase.auth().onAuthStateChanged(async (user) => {
      if (user) {
        document.getElementById('userName').textContent = user.displayName || user.email;
        
        const userDoc = await db.collection('users').doc(user.uid).get();
        const userData = userDoc.data();
        
        if (userData && userData.activities) {
          updateActivityCards(userData.activities);
        }
      } else {
        window.location.href = 'login.html';
      }
    });

    // í™œë™ ì¹´ë“œ ì—…ë°ì´íŠ¸
    function updateActivityCards(activities) {
      const activityGrid = document.querySelector('.activity-grid');
      activityGrid.innerHTML = '';

      const activityList = [
        { 
          id: 'cardgame', 
          name: 'ì¹´ë“œê²Œì„', 
          paths: [
            { path: 'cardgame/web_version/index.html', description: 'ë™ì‹œì— ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ ì‹œì‘' },
            { path: 'cardgame/web_version2/index.html', description: 'ì°¨ë¡€ëŒ€ë¡œ ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„ ì‹œì‘' }
          ]
        },
        { 
          id: 'simulator', 
          name: 'ì‹œë®¬ë ˆì´í„°', 
          path: 'simulation/ì•”ëª¨ë‹ˆì•„ì˜ ìƒì„±ë°˜ì‘(í•˜ë²„-ë³´ìŠˆë²•)/haber.html',
          description: 'ì•”ëª¨ë‹ˆì•„ í•©ì„± ì‹œë®¬ë ˆì´í„° ì‹œì‘'
        },
        { 
          id: 'test_paper', 
          name: 'ë§ŒëŠ¥ì‹œí—˜ì§€', 
          path: 'student_activity/ph_measurement/index.html',
          description: 'ì‚°-ì—¼ê¸° í‰í˜•: pH ì¸¡ì • ì¸ê³µì§€ëŠ¥'
        },
        { 
          id: 'formative_assessment', 
          name: 'í˜•ì„±í‰ê°€', 
          path: 'equilibrium_run/equilibrium_run.html',
          description: 'equilibrium run ê²Œì„ ì‹œì‘'
        }
      ];

      activityList.forEach(activity => {
        const status = activities[activity.id]?.status || 'not_started';
        const progress = activities[activity.id]?.progress || 0;
        const completedAt = activities[activity.id]?.completedAt || null;

        const card = document.createElement('div');
        card.className = `activity-card ${status}`;
        
        let buttonsHtml = '';
        if (activity.id === 'cardgame') {
          activity.paths.forEach(btn => {
            buttonsHtml += `<a href="${btn.path}" class="start-button">${btn.description}</a>`;
          });
        } else {
          buttonsHtml = `<a href="${activity.path}" class="start-button">${activity.description}</a>`;
        }

        card.innerHTML = `
          <h3>${activity.name}</h3>
          <div class="progress-bar">
            <div class="progress" style="width: ${progress}%"></div>
          </div>
          <p>ì§„í–‰ë¥ : ${progress}%</p>
          ${completedAt ? `<p>ì™„ë£Œì¼: ${new Date(completedAt).toLocaleDateString()}</p>` : ''}
          <div class="button-group">
            ${buttonsHtml}
          </div>
        `;
        activityGrid.appendChild(card);
      });
    }

    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = 'login.html';
      });
    }
  </script>
</body>
</html> 